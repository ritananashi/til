
:open_book:教材：[パーフェクトRuby on Rails【増補改訂版】](https://gihyo.jp/book/2020/978-4-297-11462-6)

4-2から。出かけるので控えめ。

### Sprockets  

Sprocketsは従来のRailsで利用されてきたフロントエンドで利用するパッケージングシステム。  
Rails6.0からWebpackerが導入され、JavaScriptはWebpackerで管理するようになったが、CSSはSprocketsでソースコードのコンパイルや縮小、圧縮を行う。  

SprocketsはCSSを拡張した言語をCSSへコンパイルする機能やリクエスト数削減のため一つのファイルに結合する処理などの機能を提供している。  
Railsがデフォルトで使っているCSS拡張言語はSCSS。  
Sassと呼ばれるツールを使ってSCSS形式とSass形式の記述形式をコンパイルしてCSSに変換している。  
コンパイルするときはファイルの拡張子から必要なコンパイラを判定する。  
複数の拡張子を重ねることで複数のコンパイルを重ねることもできる  
scaffoldを使って生成した場合はテンプレートとしてSCSSファイルも生成する。  
その時はscaffod.cssと生成したモデルのCSSファイルがsytlesheetディレクトリ内に生成される。  
application.cssはrails newの時点で生成されるCSSファイル。CSSファイルのエントリーポイントとなるファイルで、生成されたほかのファイルを読み込む設定が書かれている。  
application.css内に記述されている`*=`はSprocketsが解釈するための特別なディレクティブ。  
`*= require_tree .`で引数で指定したディレクトウィやそのディレクトリ配下のSCSSやCSSファイルの読み込みを行う。  
`*= require_self`で自身のファイル内に記述されたCSSを読み込む。  
記述した順番通りにファイルの読み込みと結合が行われるので、読み込み順を制御したい場合は順番に気を付ける。  
多くの場合はこの二つのディレクティブで十分だが、より細かい制御を行いたい場合はSprockets公式サイトにいろんなディレクティブが記載されている。
開発時はCSSファイルに変更があるときのみ、CSSファイルへアクセスするタイミングでビルドを実行するので、開発時は明示的にCSSのビルドを行う必要はない。

CSSファイルへのリンクを直接記述する場合、フィンガープリントや.debugの有無など柔軟に変更することが難しい。  
SprocketsでCSSをビルドした結果を反映する`stylesheet_link_tag`というヘルパーメソッドを使うと、環境に応じて上記の部分が動的に生成されるため細かい部分を気にせずにCSSファイルの追加を行える。  
Source Mapに対応した開発者ツールなどを使うと、CSSがどのファイルで適用されたものか確認できる。  
applications.debug-（フィンガープリント）.cssに直接アクセスすると、どのようなCSSに変換されているか確認できる。  

