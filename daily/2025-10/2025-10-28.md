※スクール内timesの移植（2025/11/18）

これつかえばよさそう？かな？  
https://techtechmedia.com/increment-decrement-rails/  

いちお～～～ロボらんてくんZにも相談してみたけどやっぱActiveStorageで`counter_cache`使えないっぽい～～～  
わるあがきでロボらんてくんZが出してきた`includes + size`もやってみたけど「`counter_cache`使って♡あと`:blob`いらないから消して♡」って言われたのでだめですね  

とりあえずproductにreviews_count作るのとbrandにproducts_count作ろう  
商品数と紐づいてるレビュー数は`counter_cache`に変えた  

応募企業の志望動機考えたり`counter_cache`使えるところを`counter_cache`に置き換えたりなどしていた。  
志望動機書くの苦手なので時間がかかってしまうのですが、今日書いたやつ（修正はいらなければ）ある程度テンプレート的に使えそうなのがかけたなと思います。修正されると思うけど…。  

ActiveStorage使用時の添付ファイル数カウントについて、ロボらんてくんZにも相談してみましたが、やっぱりActiveStorageで`counter_cache`は使えないようです。だよね。  
やっぱりもともと考えていた`キャッシュ用カラムを作って画像添付・削除時に添付画像数を数えてカウント用カラムの値を増減させる`のがいいみたいです。信じるぞ…ロボらんてくんZ…。  
他に、`includes(images_attachments: :blob)`みたいに`includes`して`count`じゃなくて`size`でやるとN+1を回避できると言われて試してみましたが、やっぱりbulletのアラートがでました。  
`count`は`COUNTクエリ`を発行して集計するメソッド、`size`はオブジェクトがメモリ上にロードされてればオブジェクトの数を返し、ロードされてなければ`COUNTクエリ`を発行して集計するメソッドだそうです。  
たぶんロードされてなかったからだと思いますが、bulletから`counter_cache`使ってというアラートと、`:blob`がいらないよというアラートが出たのでやめました。  
そういえば昨日`length`（メモリ上にロードされたオブジェクト数を返すメソッド）も試したけど`counter_cache`使ってというアラートでてたの思い出しました。今。  
なので、`キャッシュ用カラムを作って画像添付・削除時に添付画像数を数えてカウント用カラムの値を増減させる`やり方でいこうと思います。  
とりあえず今日はすぐにできるメーカーに紐づいた商品数と商品に紐づいたレビュー数の表示を`counter_cache`に置き換えました。  
画像の方は`increment`、`decrement`を使おうかと思いましたが、もうちょっと柔軟に対応できる方がいいかなと思うのでなんかいい感じのメソッドないか調べてみます。  

