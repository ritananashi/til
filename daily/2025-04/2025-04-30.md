※スクール内timesの移植（2025/09/16）

- 学習時間：5h/15h/869h
- 学習内容：卒制

天気が悪くて以下略。  
なんと明日は最低気温3℃最高気温19℃とかいうふざけた気温なので無理せずやっていきます。  
GW過ぎたら…ちょっとは落ち着くから…。

レビューの管理画面実装が終わりました。  
`destroy`アクションは`super`でオーバーライドしようかなと思いましたが、コードを確認したら`destroy!`ではなく`destroy`を使用していたので、コピペして`if request_resouce.destroy`以下に`purge`の記述しました。  
削除に失敗したときに画像だけ消えるのを避けるのに、明示的に`purge`しようと思いましたが、これやるならトランザクションに入れても良かったなと今思いました。そのうち改修します。  

レビュー終わったのでプロダクトの管理画面の実装に入りました。  
といっても、プロダクトの管理画面実装で主にやることはActiveHashの擬似モデルで実装してるCategoryをどうするか、だけだったりします。  
いや、ブランド名の選択がセレクトボックスになってるのをテキストボックス入力に変えたいなみたいなのはあるけど、一番どうにかしないといけないのがCategoryなので…。  
Administrateはモデルを参考に自動で管理画面に必要ないろいろなものを作ってくれるのですが、AcriveHashは実際のモデルは作らずに、擬似モデルを作ってモデルのようにふるまわせる、というものです。  
なので、生成されるままに使おうとすると、テーブルないよエラーがでます。  
現在はフィールドの指定をBelongsTo（関連先参照）ではなくNumber（数字入力）にしてごまかしてますが、ここをCategoryを参照するセレクトボックスに変えられるか、を調べてました。  
セレクトボックスが使える`Field::Select`がありましたので、これを使えばよさそうです。  
ただ、安定の公式のドキュメントわかりにくいよ問題で、どう記述すればいいか…。  
公式のissueやプルリクをいろいろ調べてみたところ、`[label, value]`を`collection`オプションに渡せばいいっぽいのがわかりました。→https://github.com/thoughtbot/administrate/pull/1646  
というわけで、`Category.all.collect { |c| [ c.color, c.id ] }`を`collection`オプションに渡したところ、うまくいきました :v:   
ただ、インデックスや詳細画面では依然としてIDしか表示されないので、ここを何とか出来るならしたいなあと思います。  
また公式GitHubとにらめっこしてなんとかしますね。

