※スクール内timesの移植（2025/09/28）

だるくてしんどいけどdependabotの対応だけしたい  
dependabotのバージョンアップのやつ自動化しちゃおっかな～～～と考えてるとこ  
ふむふむ  
https://zenn.dev/sumiren/articles/ffe6c0bd772718
ふむふむ  
https://qiita.com/masato_makino/items/49260907fda25a0b6b39
ふむふむ  
https://moneyforward-dev.jp/entry/2022/12/16/dependabot-automation/
検討してる間にほぼ対応終わったけど、軽微な修正のみのやつとかは自動化したいな  
ここに乗ってるサンプルはパッチ更新のみ自動マージする設定かな  
https://docs.github.com/ja/code-security/dependabot/working-with-dependabot/automating-dependabot-with-github-actions#enabling-automerge-on-a-pull-request
GitHub公式のサンプルはプルリクのタイトルに`my-dependency`が入ってる場合のパッチ更新のみ自動マージって設定みたいだから`my-dependency`が入ってる場合の条件は外してよさそう（プルリク一通り確認したけど`my-dependency`が入ってるタイトルなかった）  

- 学習時間：3h/10h/1095h
- 学習内容：dependabot対応 + dependabotのプルリクを自動mergeするように設定

だるくてしんどかったけどやりたかったdependabotの対応してました。  
dependabotの依存関係のアップデートのプルリクを内容確認して（場合によってはローカルで動かして）mergeする…にしても、軽微な修正のみのものを手動でmergeしていくのやっぱり大変だなーと思ったので自動化もしました。  
基本的には[公式ドキュメントのPull request 上で自動マージを有効にする](https://docs.github.com/ja/code-security/dependabot/working-with-dependabot/automating-dependabot-with-github-actions#enabling-automerge-on-a-pull-request)を使って、[Dependabot 運用を自動化したい](https://moneyforward-dev.jp/entry/2022/12/16/dependabot-automation/)を参考に修正とかカスタマイズとかしてGitHub Acrtionsのワークフローを作成しました。  
作成した自動mergeの条件は[Dependabot 運用を自動化したい](https://moneyforward-dev.jp/entry/2022/12/16/dependabot-automation/)と同じで、  
- パッチバージョンのアップデート、もしくは開発環境のみ利用されるライブラリのマイナーバージョンのアップデート
- CI が pass したとき

にしています。  
パッチバージョンを手動で更新はだるいのと、開発環境でしか使わないライブラリのマイナーバージョンはまあ本番環境に影響しないからええやろの考えです。  
CIの条件に関しては、ワークフロー上で設定するのではなく、ブランチ保護のルールで設定しています。  
ブランチ保護のルールの中に`Require status checks to pass`という項目があるのでここをチェックして、`Status checks that are required`のところにチェックしたいワークフローのジョブを設定すれば、CI が pass したときだけmergeできるようになります。  
自分はこれに追加で`Require branches to be up to date before merging`も設定しておきました。  
あと、Generalで`Allow auto-merge`にチェックする必要があるようです。  
というわけでワークフローを作った…のですが、これ作る前に今回ためてたdependabotからのプルリク全部mergeしちゃったので、ちゃんと動いているかは…今後新しくdependabotがプルリク作るまでわかんないや…。  
やっちまったぜと思いますが、まあなんかうまく動いていなさそうならまた修正すればいいので…。  
とりあえずこのままにしときます。

