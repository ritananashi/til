
:open_book:教材：[パーフェクトRuby on Rails【増補改訂版】](https://gihyo.jp/book/2020/978-4-297-11462-6)

### concern

Railsでは、あるモデルやコントローラを構成する一部の概念や機能を実装するモジュールのことをConsernと呼ぶ。
Concernを利用することで、特定の概念や機能に関するロジックをモデルやコントローラとは分けて実装したり、複数のモデルやコントローラの間でこれらを再利用できる。  

Concernの実装には、`ActiveSupport::Concern`を利用することが慣例になっている。  
Concernのモジュールをextendすることで、`class_methods`メソッドやブロック渡しができる`included`メソッドなどを利用できるようになる。  
モデルのConsernに何を実装すべきかは、値オブジェクトをはじめとしたオブジェクトと比べると非常にあいまい。  
モジュールとして定義するので、その中ではConcernを利用するモデルが持つ変数やメソッドを利用できることから、肥大化したモデルの見通しをよくするためにロジックを複数のConcernとして抽出して見かけのコード量を減らすといった使い方もできてしまえる。  
このように定義したConcernは特定のモデルと密接に結びついていることから、再利用できないことがほとんどで、また、ほかのConcernで定義された変数やメソッドを頻繁に利用していると、コードの見通しは悪くなってしまう。  
モデルやコントローラのConcernを利用する前に、抽出したいロジックを値オブジェクトやサービスオブジェクト、フォームオブジェクトとして実装するべきかどうかを考えると、こうした事態を避けられる。  
値オブジェクトやサービスオブジェクト、フォームオブジェクトとして実装するべきではないときだけ、Concernを利用するようにすると、Consernはデータ操作に関するロジックの実装とモデルの関連付けの宣言を行うレイヤーになる。

`ActiveSupport::Concern`は、Consernの実装を容易にしてくれるモジュール。  
`included`メソッドを使うと、引数にブロックを渡して呼び出すことができる。includeしたクラスやモジュールのクラスメソッドを呼び出すようなConsernを実装するときは、これを使うと簡単に実装できる。  
Rubyでは、あるモジュールに定義されたメソッドをクラスやモジュールのクラスメソッドとして追加するには、定義内でextendを呼び出し、インスタンスメソッドとして追加するときはincludeを呼び出すが、こうした実装をまとめて行うようなメソッドは用意されていない。  
`class_methods`メソッドは上記のような実装をまとめて行える。  
また、あるモジュールがほかのモジュールで定義された変数やメソッドを参照している場合、そのモジュールを利用するクラスでは、両方のモジュールをincludeする必要があるが、`ActiveSupport::Concern`を利用すると、クラスメソッドを介したモジュール間の依存関係を適切に解決してくれる。  

モデルやコントローラのConcernのように、`concern`メソッドというルーティングにも共通の設定を抽出して再利用するための仕組みがある。  
`concern`メソッドを利用すると、複数のリソース間で共通のルーティングをConcernとして定義できる。  
