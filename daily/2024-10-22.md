手動で画面を直接操作するよりも、繰り返しテストを行うことやエッジケースでの検証を考えるとプログラムによるテストを記述する方がトータルコストは少なくなる

Railsには標準でテストを実行する環境が整えられている。
scaffoldでコード生成すると対応するテストコードも自動で生成される

bin/rails testでテスト実行
その前にテスト用データベースの設定を反映しておく
railsのデフォでは開発時のデータベースはdevelopment、テスト環境時のデータベースをtestと名前付けして開発時のデータとテスト時のデータが混在しないようにしている
テスト環境で未実行のマイグレーションファイルがあってもテスト実行時に自動でdb/schema.rbか
テスト用のデータベース設定をロードするが、schema.rbが最新じゃない時など、ロードした後も未実行のマイグレーションファイルがある場合はエラーになる

システムテスト以外のテストはbin/rails test
システムテストはbin/rails test:system
より詳細なテストケースについて確認したい時は-vオプションをつかうと具体的なassert単位での実行時間や進捗状況がわかる
ディレクトリ単位、ファイル単位でのテスト時はテストしたいディレクトリやファイルを指定
bin/rails test test/modelsとか
特定の行だけテストする時はテストファイルの末尾に続けて:行番号で指定
テスト名を指定して実行する時は-n(または--name)オプションで指定
bin\rails test test/models/todo_test.rb:5
bin\rails test test test/models/todo_test.rb -n test_the_truth

railsは標準テストフレームワークでminitestを使っている
ほかによく使われるフレームワークとしてRSpecがある。カリキュラムはこっち
railsのテストはミニテストをベースとし、それぞれのレイヤーごとに拡張されたテストクラスを継承することでより簡単にテストをきじゅつできるようになっている

テスト記述時に使うassertメソッドにはミニテストの代表的なやつとRailsで拡張したやつがある
Railsガイドに詳しく載ってる

fixtureはモデルクラスに対応するテストデータをあらかじめ作っておくファイル(チュートリアルで見た)
yaml形式で定義
実際の開発現場ではfixture replacementと呼ばれるライブラリがつかわれることがある。factory_botとか(カリキュラムで見た)

setupがテスト実行前、teardownが実行後に呼び出される
rails6ではテストの並列実行がデフォ
並列化の設定はtest/test_helper.rbに記述されている
parallelize(workers: :number_of_processors)が並列度を指定する値
:number_of_processorsはCPUの数で並列実行する指定
with: :threadsにするとスレッドによる並列実行になる並列テストを行う時はデータベースも並列度に合わせて用意される

Rack
webアプリケーションサーバーとwebアプリケーションフレームワーク間のインターフェイスを共通化した仕様であり実装となっているライブラリ
Rackを仲介できるインターフェイスを持つことでUnicornやPumaといったアプリケーションサーバーとRailsををはじめとするフレームワーク間でスムーズなやり取りが行えるようになっている

Rack登場以前はアプリケーションサーバーとフレームワークが密結合していてAというフレームワークはXというアプリケーションサーバーでは動かなかった
Rackが登場し、Rackインターフェイスへの対応が進んだ結果、フレームワークとアプリケーションサーバーの組み合わせを柔軟に選択できるようになった
RailsもRackインターフェイスに則っているので、UnicornやPumaといった複数のWebアプリケーションサーバー上で動かせる
Rackが登場する前は、フレームワークとアプリケーションサーバーの組み合わせによってデプロイ方法が複雑になってしまっていた
各アプリケーションサーバーやフレームワークがrackに対応することでそれぞれの組み合わせを変更することが容易になり、開発者にとってもより良い組み合わせを選択することができるようになった

マイグレーションファイル内で使用できる専用メソッド→up down change
テーブルの情報を反映する時はup、巻き戻す時はdown
changeはupとdown両方で呼ばれるメソッド

create_tableをはじめいくつかのメソッドはchange内で利用するとupとdownの文脈で適切に動作する

スキーマファイルにデータベースに定義されている内容が反映される
スキーマファイルを読み込むことでマイグレーションを実行することなく現在のデータベース環境を作成することもできる

Rails6から複数データベースに対応。
使うかどうかがわからん…機能としてあることだけ覚えておく
