※スクール内timesの移植（2025/09/19）

キター！！！！！
[![Image from Gyazo](https://i.gyazo.com/bd84901696ef84bb541047c675282f9a.png)](https://gyazo.com/bd84901696ef84bb541047c675282f9a)

Rails.application.credentials.digじゃないとだめなのなんでなん？  
Twitter2 アカウントによる認証に失敗しました。理由：（Invalid credentials） :pleading_face:

Xログイン（おそらく）できた！Xからとってきたアイコンの画質悪すぎワロエナイ  
Xのアカウント名とユーザー名が、既に保存されてるユーザー情報と合致するときに情報を紐づけるかでちょっと悩み中  
Xのemailは取ってこれないからアカウント名とユーザー名のみでの判定になっちゃうしやめとこ  
本番環境でも成功 :v:

- 学習時間：4h30min/13h30min/979h30min
- 学習内容：卒制
  

Xログインできました！  
やっぱりcredentialsの呼び出しが良くなくてちゃんと呼び出したらアクセスの許可のページに遷移しました。  
ただ、最初`Rails.application.credentials.twitter[:access_key_id]`みたいに書いてたらやっぱり`アプリにアクセスを許可できません。`ページに飛んでしまっていたのでなんでや～～～としてました。2時間くらいGPTと喧嘩したりググったりしてた。  
Twitter OAuth2を使って実装してる人おらんか…と思ってググってたら、RailsでTwitter OAuth 2認証を実装するみたいな動画（[Twitter Authentication OAuth 2 with omniauth and Rails](https://www.youtube.com/watch?v=kgGFM4BdVSM)）があって（英語だし字幕も英語で何言ってるかわかんないけど）、これを見ていたら`Rails.application.credentials.dig`を使っていたので、試しに`Rails.application.credentials.dig`に変えてみたら  
[![Image from Gyazo](https://i.gyazo.com/bd84901696ef84bb541047c675282f9a.png)](https://gyazo.com/bd84901696ef84bb541047c675282f9a)
で、できたー！！！  
このあとアクセスを許可してみたけど、`Twitter2 アカウントによる認証に失敗しました。理由：（Invalid credentials）`というエラーが出て認証には失敗しました。  
403エラーが出ていたので、調べてみたらコールバックURLを設定しろ（設定してるが…）とか権限スコープの範囲広げろだとか出てきたので、なるべく広めにとったけど`tweet.read`と`users.read`を設定しておけばよいみたいです。  
https://devcommunity.x.com/t/accessing-2-users-me-through-oauth-2-0-returns-403/188988  
https://docs.x.com/resources/fundamentals/authentication/guides/v2-authentication-mapping  
というわけでXログイン実装完了です。  

