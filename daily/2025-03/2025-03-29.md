※スクール内timesの移植（2025/09/04）

ハア…ハア…これは…負けです（CDNを使った）  
[![Image from Gyazo](https://i.gyazo.com/069fda196fa5c80d2a729e8c685309e4.gif)](https://gyazo.com/069fda196fa5c80d2a729e8c685309e4)

SwiperのCSSがCDNだとElementタブに出てくるけどyarnでインストールしたのを読み込むと出てこないのはnode_moduleからうまくとってこれてないのか（assets/buildにはswiper.css出てきたけど…）TailwindのJITモードの影響か（Tailwindじゃないのにあり得る？）

- 学習時間：6h30min/34h/727h
- 学習内容：卒制
  
yarnでインストールしたSwiperがうまく当たらなくて最終的にCDNで使うことにしました。  
assets/buildにはSwiperのcssファイルが出てきたので、読み込みはちゃんとされていると思うのですが、Elementタブで生成されてるSwiperのcssの詳細がみれない、という状況でした。  
CDNで入れたらちゃんと反映されたのでとりあえずこれで行きます。  
CSSは生成されてるけどElementタブで詳細が見れない、というのは以前フラッシュメッセージのスタイルが反映されなかったときと類似の状況だなとは思うのですが、TailwindのCSSじゃないのにTailwindのJITモードの影響を受けるのか？がちょっとよくわかりません。  
safelistに生成されたCSSを一部登録してみましたが、反映されているようには見えなかったのであんまり関係ないかも。  
色々調べてみてどこかでリベンジします。  
  
あとは投稿の編集機能も作ってました。  
画像でバリデーションエラーが発生すると、保存されなかった新しい画像を探してしまってエラーが出てしまっていたのですが、[こちらの投稿](https://stackoverflow.com/questions/60083633/active-storage-still-detects-attachement-even-after-validation-failure)の`reload`メソッドを使う対応でうまくいきました。  
その後、画像をアップロードせずに編集をするともともと添付されてた画像が消えてしまうので、ここをなんとかするべくいろいろ調べてました。`reload`メソッドは関係なかったよ…。  
渡されてる画像のパラメータが`"images"=>[""]`になっているのは画像をアップロードしてないから当たり前だと思うんですが、ログを見たらDELETEが走ってました。なぜ。  
[Rails: ActiveStorageでファイルを削除するときは、単にnilで更新するだけでいい](https://techracho.bpsinc.jp/konaga/2023_08_22/133768)  
もしかして…nilがわたってるから…画像が削除されちゃう…ってコト！？  
結構困る仕様では…？  
ということで、ここをどげんかせんといかんのでいろいろ調べてみます。  
複数枚画像投稿で投稿を編集したときに画像が消えちゃうってなんか記事ありそうな気がするけど探し方が悪いのかいまいち見つからない…。
