
📖[プロを目指す人のためのRuby入門［改訂2版］ 言語仕様からテスト駆動開発・デバッグ技法まで](https://gihyo.jp/book/2021/978-4-297-12437-3)

#### 配列についてもっと詳しく（つづき）

- ==で等しい配列かどうか判断する
  `==`で左辺と右辺の配列が等しいかチェックする。配列の全要素を`==`で比較して、すべて等しかったらtrueが返る。

- %記法で文字列の配列を簡潔に作る
  文字列で配列を作るときは、%記法の`%w`か`%W`を使って配列を作成できる。
  %記法を使うと、commaではなく空白文字が要素の区切り文字になる。
  文字列を""や''で囲わなくてよいので、[]で配列を作るよりもコードが短くなる。
- 文字列を配列に変換する。
  `chaes`メソッドや`split`メソッドを使うと、文字列を分解して配列にできる。
  ```ruby
  # charsメソッドは文字列中の一文字一文字を配列の要素に分解する。
  'Ruby'.chaes #=> ["R", "u", "b", "y"]
  # splitメソッドは引数で渡した区切り文字で文字列を配列に分割する。
  'Ruby, Java, Python'.split(',') #=> ["Ruby", "Java", "Python"]
  ```

- 配列にデフォルト値を設定する
  配列は`Array.new`でも作成できる。
  `Array.new`に引数を渡すと、その個数分の要素が追加される。このとき追加される要素はnil。
  第二引数を指定すると、nil以外のデフォルト値を設定できる。
  ブロックを使ってデフォルト値を設定することもできる。このときブロックは作成する要素の数だけ呼ばれ、ブロックパラメータには要素の添え字が渡される。
  配列にはブロックの戻り値がそれぞれデフォルト値として設定される。

- 配列にデフォルト値を設定する場合の注意点
  第二引数にデフォルト値を指定する場合は、配列の全要素が同じ文字列オブジェクトを参照することになるため、配列内の一つだけを変更しようとしても、ほかの要素も一緒に変更されてしまう。
  ブロックでデフォルト値を渡すようにすると、ブロックが呼ばれるたびに文字列のデフォルト値が新しく作成されるので、配列は別々の文字列を参照する。
  これなら要素を一つだけ変更できる。
  同じ値で同一のオブジェクトなのか、同じ値で異なるオブジェクトなのかを意識する必要がある。

- ミュータブル？イミュータブル？
  ミュータブル = 変更可能な
  イミュータブル = 変更できない、不変の
  ミュータブルなオブジェクトには破壊的な変更が適用される。なので、配列の要素が同じオブジェクトを参照していると、破壊的な変更によって変わってほしくない値まで変わってしまう。文字列はミュータブル。
  イミュータブルなオブジェクトでは破壊的な変更が適用できないので、ブロックを使わないでデフォルト値を設定しても、文字列で発生したような不具合は発生しない。
  数値、シンボル、true/false、nil、範囲はイミュータブルな値。なので、これらをデフォルト値に設定しても破壊的な変更はできないので、ほかの要素も一緒に変更されることはない。
  ミュータブルなオブジェクトには`freeze`メソッドを使って変更を禁止することもできる。

#### ブロックについてもっと詳しく

- 添え字付きの繰り返し処理
  `each_with_index`メソッドを使うと、ブロックパラメータの第2パラメータに添え字を渡せる。
  ので、これを使うと繰り返し処理で何番目の要素の処理をしているのかがわかるようになる。

- with_indexメソッドを使った添え字付きの繰り返し処理
  `map`メソッドなどで繰り返し処理をしつつ、添え字も同時に取得したいときは`with_index`メソッドを組み合わせて使う。
  `with_index`メソッドはEnummeratorクラスのインスタンスメソッド。
  繰り返し処理を行うメソッドの大半はブロックを省略して呼び出すと、Enummeratorオブジェクトを返す。ので、`with_index`メソッドを呼び出すことができる。

- 添え字を0以外の数値から開始させる
  `with_index`メソッドに引数を渡すと、添え字が引数で渡した数値から始まる。

- 配列がブロックパラメータに渡される場合
  二次元配列に対して繰り返し処理を実行すると、ブロックパラメータに配列がわたる。
  ブロックパラメータを複数個にすると、配列内の要素を別々に受け取ることができる。
  ブロックパラメータが多すぎるときは、はみ出しているブロックパラメータはnilになる。
  配列の要素数よりもブロックパラメータの数が少ないときは、はみ出した要素が捨てられる。
  二次元配列で`each_with_index`メソッドを使って、各要素をブロックパラメータに入れ、インデックス番号も取得したいときは。要素を入れるブロックパラメータを()で囲う。

- 番号指定パラメータ
  ブロックパラメータとして番号指定パラメータが使えるようになった。
  番号指定パラメータは、明示的にブロックパラメータを指定する代わりに、パラメータの順番に応じて_1から_9までの番号を使うことができる。
  ブロックが入れ子になっている場合、番号指定パラメータが2つ以上のブロックで使われているとエラーになってしまう。番号指定パラメータが一つだけ誰ばエラーにならない。
  連番を使うとデータの中身がわかりづらくなるデメリットがある。
