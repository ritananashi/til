
📖[プロを目指す人のためのRuby入門［改訂2版］ 言語仕様からテスト駆動開発・デバッグ技法まで](https://gihyo.jp/book/2021/978-4-297-12437-3)

#### ハッシュとキーワード引数についてもっと詳しく

- ハッシュで仕様頻度の高いメソッド  
  - keys  
    ハッシュのキーを配列として返す。
  - values  
    ハッシュの値を配列として返す
  - has_key?/key?/include?/menber?  
    has_key?メソッドはハッシュの中に指定されたキーが存在するかどうか確認するメソッド。  
    key?/include?/menber?はエイリアスメソッド。

- `**`でハッシュを展開させる  
  ハッシュの前に`**`を付けると、ハッシュリテラル内でほかのハッシュの要素を展開できる。
  ```ruby
  h = { us: 'dollar', india: 'rupee' }
  { japan: 'yen', **h } #=> {:japan=>"yen", :us=>"dollar", :india=>"rupee"}

  # **を付けないと構文エラーになる。
  { japan: 'yen', h } #=> syntax error
  ```
  **の代わりに`merge`メソッドを使っても同じ結果になる。

- ハッシュを使った疑似キーワード引数  
  キーワード引数が導入される前は、メソッドの定義で引数としてハッシュそのものを受け取るようにしていた。  
  このようにハッシュを受け取ってキーワード引数のように見せるテクニックを疑似キーワード引数と呼ぶ。  
  キーワード引数を使った場合と比較すると、ハッシュから値を取り出す分コードが増える、存在しないキーを渡してもエラーにならない、などがある。  
  後方互換性維持のためにRuby3.0でも有効になっているが、新しく書くコードでの仕様は推奨されていない。

- 任意のキーワードを受け付ける`**`引数  
  `**`を付け引数を最後に用意すると、任意のキーワードを受け取れる。  
  `**`を付けた引数にはキーワード引数で指定されていないキーワードがハッシュとして格納される。

- ハッシュを明示的にキーワード引数に変換する`**`  
  Ruby2.0～2.7ではハッシュをメソッドの引数として渡すと、自動的にキーワード引数に変換されていたが、Ruby3.0からはキーワード引数への自動変換が行われなくなったため、エラーが出るようになった（Ruby2.7でも警告がでる）。  
  なので、`**`をつかって明示的にハッシュをキーワード引数に変換しなければならなくなった。

- メソッド呼び出し時の{}の省略  
  最後の引数がハッシュであれば、ハッシュリテラルの{}を省略できる、というルールがある。  
  `eat_lunch(`pasta`, 'drink' => true, 'sweet' => true)`  
  あくまでも最後の引数がハッシュであれば、という条件なので、最後の引数がハッシュじゃなかったらエラーになる。  
  配列リテラルでも、最後がハッシュだったら{}は省略可能。

- ハッシュリテラルの{}とブロックの{}  
  メソッドの引数でハッシュを渡すとき、メソッド呼び出しの()を省略してしまうと、ハッシュリテラルの{}がブロックの{}として解釈されてしまう。  
  メソッドの第一引数にハッシュを渡す場合は、必ずメソッド呼び出しの()を付ける必要がある。  
  第二引数以降にハッシュが来るときは()を省略してもエラーにはならない。
  
