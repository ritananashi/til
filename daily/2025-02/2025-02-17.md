
📖プロを目指す人のためのRuby入門［改訂2版］ 言語仕様からテスト駆動開発・デバッグ技法まで

#### ハッシュとキーワード引数についてもっと詳しく（つづき）

- ハッシュから配列へ、配列からハッシュへ  
  `to_a`メソッドでハッシュ　→　配列に変換。  
  ハッシュの各要素ごとにまとまった二次元配列になる。  
  `to_h`メソッドで配列　→　ハッシュに変換。  
  二次元配列の内の各配列ごとにキーと値の組み合わせに変換されるので、1次元配列に対して使うとエラーになる。  
  キーが重複したら最後に登場した配列の要素がハッシュの値になる。不具合の原因になるので、特別な理由がない限りはキーは必ず一意な値にしておく。

- ハッシュのデフォルト値を理解する  
  `Hash.new`は引数に渡された値をデフォルト値にするが、配列の時と同じく、デフォルト値として毎回同じオブジェクトが返ってしまうため、デフォルト値に対して破壊的な変更を適用すると、ほかの変数の値も一緒に代わってしまう。  
  ミュータブルなオブジェクトをデフォルト値として指定するときは、ブロックを組み合わせてデフォルト値を返すことで、この問題を回避できる。  
  `Hash.new`にブロックを与えると、ブロックパラメータとしてハッシュ自身と見つからなかったハッシュが渡されるので、ブロックパラメータを使ってハッシュにキーとデフォルト値を同時に設定することもできる。
  ```ruby
  h = Hash.new { |hash, key| hash[key] = 'hello' }
  h[:hoo]
  h[:baa]
  # ハッシュにキーと値が追加されている
  h #=> {:hoo=>"hello", :bar=>"hello"}
  ```

- その他、キーワード引数に関する高度な話題  
  - `**nil`引数  
    メソッド定義にこれが含まれていると、そのメソッドがキーワード引数を一つも受け取らないことを意味する。  
    `**nil`があるメソッドにキーワード引数を渡すと呼び出しエラーになる。  
    ハッシュオブジェクトを引数として渡すのはOK
  - ...を使った引数の委譲  
    ```ruby
    def foo(...)
      bar(...)
    end
    ```
    この書き方で、通常の引数とキーワード引数をまとめて別のメソッド（今回はbar）に渡すことができる。

#### シンボルについてもっと詳しく

- シンボルを作成するさまざまな方法  
  シンボルはコロンに続けて、変数名やクラス名、メソッド名の識別子として有効な文字列を書く。  
  グローバル変数の$やインスタンス変数の@、+や==などの差異定義可能な演算子も:を付けてシンボルにできる。  
  識別子として無効な文字列を使うとエラーが発生するが、シングルクオートで囲むとシンボルとして有効になる。  
  ダブルクオートを使うと文字列と同じように式展開できる。  
  ハッシュを作るときに`文字列リテラル: 値`の形式で書いた場合も、`:文字列リテラル`と同じようにみなされて、キーがシンボルになる。

- ％記法でシンボルやシンボルの配列を作成する。  
  `%s`でシンボルを作成できる。  
  ```ruby
  # !を区切り文字に使う
  %s!hello! #=> :"hello"
  # ()を区切り文字に使う
  %s(hello) #=> :"hello"
  ```
  `%i`でシンボルの配列を作成できる。空白文字が要素の区切りになる。
  ```ruby
  %i(apple banana orange) #=> [:apple, :banana, :orange]
  ```
  改行文字を含めたり、式展開したりするときは`%I`を使う。

- シンボルと文字列の関係  
  文字列とシンボルは、見た目は似ているが別物なので互換性はない。  
  しかし、`to_sym`メソッドを使うと文字列をシンボルに変換することができる。  
  `to_s`メソッドでシンボルを文字列に変換することもでき宇r。  
  メソッドによっては文字列とシンボルを同等に扱うものもある。が、メソッドの仕様による。  
  一般的には同等に扱わないケースの方が多い。
  
  
