※スクール内timesの移植（2025/11/25）

書きました  
https://qiita.com/ritananashi/items/6836526a57d12a8b18b8  

Administrate::Field:ActiveStorageとの兼ね合いがあるからアプデどうするかな～～～なんだよね  

記事書いたり今度の面接の準備したりしていた。  
昨日一応祝日だから一日の終わりのまとめは書かなかったけど、最新のマイグレーションファイルがdownになっていて追加したかったカラムが追加されておらず、エラーになっていたので原因調べて直したりしてました。  
レビューに添付されてる画像枚数を調べて`images_count`カラムに反映させるマイグレーションファイルの処理が重くてタイムアウトしてたっぽいです。  
`counter_cache`の`reset_counter`を使ってる`reviews_count`や`products_count`への処理はすぐに終わってたみたいなので、`reset_counter`メソッドが使えるときは使って、`update_all`や`update_column`を使って処理したいときはRails runnerか何かでやる方が安全かなと思います。  
本番環境でdownだったから、ローカルでも該当マイグレーションファイルをdownして削除してスクリプトに切り出してRails runnerで実行して直しました。  
N+1対応したプルリクをmergeした後、本番環境のほうの確認を怠っていたのでちゃんと確認しないとなあと思いました。  

で、昨日中断された記事の続きを書いてました。  
Administrateのカスタマイズについての記事です。実はもう少しカスタマイズしている部分があるのですが、連携しているgemの理解不足でやらなくていい実装をした可能性が浮上したのでこの件については書いてないです。  
また今度検証してから追記します。  
Railsの管理画面系gemでAdministrateはあんまり採用されてない印象ありますが、普段Railsでやっているように書けばカスタマイズできるので、わりと初学者には扱いやすいほうなんじゃないかなと記事書いてて思いました。  
そこはそれとしてカスタマイズしてるとつらくなってくる部分もあるので、gemなしで実装したほうが融通は利くかなと思います。  

