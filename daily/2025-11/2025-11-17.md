※スクール内timesの移植（2025/11/25）

Railsのソースコードむずかちいよお…  
とりあえず4枚添付済みの投稿にさらに追加しようとしたらエラーになるのは確認できたので`attach`で良いと思う。  

createの時save前にattachできるやん！！！！前できなかったのはなんでなん？  
もう細かいとこ覚えてないけどなんか違ったとかだったのかなあ…Administrateでもできなかったんだけどなあ…  
バリデーションエラーが出るはずの投稿をしたら`Cannot get a signed_id for a new record`が出たと…。  
いまわかってること  
- 画像添付済みの投稿に、添付済みの画像合わせて4枚以上添付しようとするとバリデーションエラーが出る。
- 新規投稿で4枚以上の画像を添付して投稿しようとしたら、バリデーションエラーではなく`ActionView::Template::Error (Cannot get a signed_id for a new record):`がでる（バリデーションエラーが出るのが正しい）

こないだの続きやってた。  
`attach`は`document.images.attach(io: File.open("/path/to/racecar.jpg"), filename: "racecar.jpg", content_type: "image/jpeg")`の形でアップロードしたいファイルを受け取れるから、`[{io: File.open(Tempfile), filename: "filename.webp", content_type: "image/webp"}, {io: File.open(Tempfile), filename: "filename.webp", content_type: "image/webp"}]`みたいな形で渡せば`UploadedFile`を加工したりインスタンスを新しく作り直したりしなくても適切にファイルアップロードしてくれる。  
この辺の仕組み、GPTに聞いてみてるけどむずかち～～～となっている。今日は頭が回らない。  
updateは問題なく画像枚数のバリデーションも機能したけど、createだとバリデーションエラーがうまいこといってない。  
以前未保存オブジェクトにファイルをattachできなかったけど今回はできたので不思議だな～～～～～～としている。  
ActiveStorage蒸すかしいね…。  

